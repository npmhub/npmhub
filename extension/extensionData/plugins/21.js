
var DebugManager=(function(h){var f={appId:appAPI._cr_config.appID(),url:appAPI._cr_config.debug_app};return h.Class.extend({init:function(){if(appAPI.isMatchPages.apply(this,f.url.debug_page)){h(document).ready(function(){h("body").bindExtensionEvent("debug_request_data",function(j,i){if(i.appId==f.appId){e();}});h("body").bindExtensionEvent("debug_request_reload_background",function(j,i){if(i.appId==f.appId&&appAPI.internal.reloadBackground){appAPI.internal.reloadBackground();}});h("body").bindExtensionEvent("debug_request_reload_plugins",function(j,i){if(i.appId==f.appId){appAPI.resources.requestReload();setTimeout(appAPI.internal.forceUpdate,750);}});h("body").bindExtensionEvent("debug_mode_activate",function(j,i){if(i.appId==f.appId){b(i);}});h("body").bindExtensionEvent("debug_mode_deactivate",function(j,i){if(i.appId==f.appId){appAPI.internal.debug.turnOff();}});h("body").bindExtensionEvent("debug_request_database",function(j,i){if(i.appId==f.appId){c(i);}});h("body").bindExtensionEvent("debug_request_database_remove",function(j,i){if(i.appId==f.appId&&i.key){appAPI.db.remove(i.key);}});h("body").bindExtensionEvent("debug_request_database_update_value",function(j,i){if(i.appId==f.appId&&i.key){appAPI.db.set(i.key,i.value,appAPI.db.getExpiration(i.key));}});h("body").bindExtensionEvent("debug_request_database_update_expiration",function(j,i){if(i.appId==f.appId&&i.key){appAPI.db.updateExpiration(i.key,new Date(i.value));}});h("body").bindExtensionEvent("debug_request_database_update_key",function(j,i){if(i.appId==f.appId&&i.key&&i.value){appAPI.db.set(i.value,appAPI.db.get(i.key),appAPI.db.getExpiration(i.key));appAPI.db.remove(i.key);}});h("body").bindExtensionEvent("debug_request_database_create",function(j,i){if(i.appId==f.appId&&i.key){appAPI.db.set(i.key,i.value,new Date(i.expires));}});h("body").bindExtensionEvent("debug_request_database_remove_all",function(j,i){if(i.appId==f.appId){appAPI.db.removeAll();}});});}},isDebug:function(){return appAPI.internal.debug.isDebugMode();},getResourcesPath:function(){return g();}});function g(){return appAPI.internal.db.get("debug_resources_path");}function b(k){var i={},j;if(k.isDebugMode){i.userCode=appAPI.internal.file.get(a(k.debug.userCode)).err?false:k.debug.userCode;i.backgroundCode=appAPI.internal.file.get(a(k.debug.backgroundCode)).err?false:k.debug.backgroundCode;if(i.userCode!==false&&i.backgroundCode!==false){appAPI.internal.db.set("debug_path",k.debugPath);appAPI.internal.db.set("debug_activated",true);appAPI.internal.db.set("debug_resources_path",k.debug.resourcesPath);setTimeout(function(){setTimeout(function(){appAPI.internal.debug.turnOn({userCode:k.debug.userCode,backgroundCode:k.debug.backgroundCode});setTimeout(function(){h("body").fireExtensionEvent("debug_mode_state_result",i);},2000);},10);},3000);}else{h("body").fireExtensionEvent("debug_mode_state_result",i);}}}function d(){appAPI.internal.debug.turnOff();}function e(){setTimeout(function(){h("body").fireExtensionEvent("debug_request_data_result",{debugPath:appAPI.internal.db.get("debug_path")||"",isDebugActivated:appAPI.internal.db.get("debug_activated")===true,isDebugMode:appAPI.internal.debug.isDebugMode(),debug:{userCode:appAPI.internal.debug.getDebugUrl().userCode,backgroundCode:appAPI.internal.debug.getDebugUrl().backgroundCode,resourcesPath:g()}});},750);}function c(){h("body").fireExtensionEvent("debug_response_database",appAPI.db.getList());}function a(i){return i+"?r="+Math.random();}}($jquery_171));(function(a){appAPI.debugManager=new DebugManager();}($jquery_171));
